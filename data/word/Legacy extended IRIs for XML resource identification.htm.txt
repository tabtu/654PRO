legacy extended iris for xml resource identification legacy extended iris for xml resource identification w3c working group note 3 november 2008 bnf comment style corrected in place 2009-07-09 this version http www.w3.org tr 2008 note-leiri-20081103 latest version http www.w3.org tr leiri previous version editors henry s. thompson university of edinburgh ht@inf.ed.ac.uk richard tobin university of edinburgh richard@inf.ed.ac.uk norman walsh mark logic corporation norman.walsh@marklogic.com this document is also available in these non-normative formats xml. copyright 2008 w3c mit ercim keio all rights reserved. w3c liability trademark and document use rules apply. abstract for historic reasons some formats have allowed variants of iris that are somewhat less restricted in syntax for example xml system identifiers and w3c xml schema anyuris. this document provides a definition and a name legacy extended iri or leiri for these variants for easy reference. these variants have to be used with care they require further processing before being fully interchangeable as iris. new protocols and formats should not use legacy extended iris. status of this document this section describes the status of this document at the time of its publication. other documents may supersede this document. a list of current w3c publications and the latest revision of this technical report can be found in the w3c technical reports index at http www.w3.org tr this document is a w3c working group note. it has been developed by the xml core working group part of the xml activity in the w3c ubiquitous web domain. publication as a working group note does not imply endorsement by the w3c membership. this is a draft document and may be updated replaced or obsoleted by other documents at any time. it is inappropriate to cite this document as other than work in progress. please send comments about this document to xml-editor@w3.org archived this document is very closely based on material from iri-bis specifically section 2.2 abnf for iri references and iris and section 7 legacy extended iris included here by permission of its authors. it is intended to provide a basis for a single normative reference from many xml- and or html-related standards in advance of the final publication of iri-bis as an rfc. when that publication occurs this specification will be re-issued to reference it in place of the extracts given below. this document was produced by a group operating under the 5 february 2004 w3c patent policy. w3c maintains a public list of any patent disclosures made in connection with the deliverables of the group that page also includes instructions for disclosing a patent. an individual who has actual knowledge of a patent which the individual believes contains essential claim s must disclose the information in accordance with section 6 of the w3c patent policy. table of contents 1 introduction 2 notation 3 legacy extended iri syntax 4 conversion of legacy extended iris to iris 5 characters allowed in legacy extended iris but not in iris appendix a references 1 introduction for historic reasons some formats have allowed variants of iris rfc3987 that are somewhat less restricted in syntax for example xml system identifiers and w3c xml schema anyuris. this document provides a definition and a name legacy extended iri or leiri for these variants for easier reference. these variants have to be used with care they require further processing before being fully interchangeable as iris. new protocols and formats should not use legacy extended iris. the provisions in this document also apply to legacy extended iri references. 2 notation in this document characters are referenced by using a prefix of u+ followed by four to six hexadecimal digits. in this document the key words must must not required shall shall not should should not recommended may and optional are to be interpreted as described in rfc2119 3 legacy extended iri syntax the syntax of legacy extended iris leiris and leiri references is the same as that for iris and iri references except that ucschar is redefined. the syntax of this abnf is described in rfc5234 character numbers are taken from the ucs without implying any actual binary encoding. terminals in the abnf are characters not bytes. for consistency with rfc3987 for iris generic leiri software should not check leiris for conformance to this syntax. some productions are ambiguous. the first-match-wins a.k.a. greedy algorithm applies. for details see rfc3986 productions changed from rfc3986 1 leiri scheme ihier-part iquery ifragment 2 ihier-part iauthority ipath-abempty ipath-absolute ipath-rootless ipath-empty 3 leiri-reference leiri irelative-ref 4 absolute-leiri scheme ihier-part iquery 5 irelative-ref irelative-part iquery ifragment 6 irelative-part iauthority ipath-abempty ipath-absolute ipath-noscheme ipath-empty 7 iauthority iuserinfo ihost port 8 iuserinfo iunreserved pct-encoded sub-delims 9 ihost ip-literal ipv4address ireg-name 10 ireg-name iunreserved pct-encoded sub-delims 11 ipath ipath-abempty begins with or is empty ipath-absolute begins with but not ipath-noscheme begins with a non-colon segment ipath-rootless begins with a segment ipath-empty zero characters 12 ipath-abempty isegment 13 ipath-absolute isegment-nz isegment 14 ipath-noscheme isegment-nz-nc isegment 15 ipath-rootless isegment-nz isegment 16 ipath-empty 0 ipchar 17 isegment ipchar 18 isegment-nz 1 ipchar 19 isegment-nz-nc 1 iunreserved pct-encoded sub-delims non-zero-length segment without any colon 20 ipchar iunreserved pct-encoded sub-delims 21 iquery ipchar iprivate 22 ifragment ipchar 23 iunreserved alpha digit ucschar 24 iprivate xe000-f8ff xe0000-e0fff xf0000-ffffd x100000-10fffd productions unchanged from rfc3986 25 scheme alpha alpha digit 26 port digit 27 ip-literal ipv6address ipvfuture 28 ipvfuture v 1 hexdig 1 unreserved sub-delims 29 ipv6address 6 h16 ls32 5 h16 ls32 h16 4 h16 ls32 1 h16 h16 3 h16 ls32 2 h16 h16 2 h16 ls32 3 h16 h16 h16 ls32 4 h16 h16 ls32 5 h16 h16 h16 6 h16 h16 30 h16 1 4hexdig 31 ls32 h16 h16 ipv4address 32 ipv4address dec-octet dec-octet dec-octet dec-octet 33 dec-octet digit 0-9 x31-39 digit 10-99 1 2digit 100-199 2 x30-34 digit 200-249 25 x30-35 250-255 34 pct-encoded hexdig hexdig 35 unreserved alpha digit 36 reserved gen-delims sub-delims 37 gen-delims 38 sub-delims modified ucschar production 39 ucschar x0-1f x7f-d7ff xe000-fffd x10000-10ffff the restriction on bidirectional formatting characters in section 4.1 of rfc3987 is lifted. the iprivate production becomes redundant. formats that use legacy extended iris may further restrict the characters allowed therein either implicitly by the fact that the format as such does not allow some characters or explicitly. an example of a character not allowed implicitly may be the nul character u+0000 however all the characters allowed in iris must still be allowed. 4 conversion of legacy extended iris to iris to convert a legacy extended iri reference to an iri reference each character allowed in a legacy extended iri reference but not allowed in an iri reference see 5 characters allowed in legacy extended iris but not in iris must be percent-encoded by applying the following steps convert the character to a sequence of one or more octets using utf-8 rfc3629 convert each octet to hh where hh is the hexadecimal notation of the octet value. note that this is identical to the percent-encoding mechanism in section 2.1 of rfc3986 to reduce variability the hexadecimal notation should use uppercase letters. replace the original character with the resulting character sequence that is a sequence of hh triplets conversion from a leiri to an iri or a uri must be performed only when absolutely necessary and as late as possible in a processing chain. in particular neither the process of converting a relative leiri to an absolute one nor the process of passing a leiri to a process or software component responsible for dereferencing it should trigger percent-encoding. 5 characters allowed in legacy extended iris but not in iris this section provides a list of the groups of characters and code points that are allowed in legacy extedend iris but are not allowed in iris or are allowed in iris only in the query part. for each group of characters advice on the usage of these characters is also given concentrating on the reasons not to use them. space u+0020 some formats and applications use space as a delimiter for example for items in a list. appendix c of rfc3986 also mentions that white space may have to be added when displaying or printing long uris the same applies to long iris. this means that spaces can disappear or can make the legacy extended iri to be interpreted as two or more separate iris. delimiters u+003c u+003e and u+0022 appendix c of rfc3986 suggests the use of double-quotes http example.com and angle brackets http example.com as delimiters for uris in plain text. these conventions are often used and also apply to iris. legacy extended iris using these characters will be cut off at the wrong place. unwise characters u+005c u+005e u+0060 u+007b u+007c and u+007d these characters originally have been excluded from uris because the respective codepoints are assigned to different graphic characters in some 7-bit or 8-bit encoding. despite the move to unicode some of these characters are still occasionally displayed differently on some systems for example u+005c as a japanese yen symbol. also the fact that these characters are not used in uris or iris has encouraged their use outside uris or iris in contexts that may include uris or iris. in case a legacy extended iri with such a character is used in such a context the legacy extended iri will be interpreted piecemeal. the controls c0 controls del and c1 controls u+0000 u+001f u+007f u+009f there is no way to transmit these characters reliably except potentially in electronic form. even when in electronic form some software components might silently filter out some of these characters or may stop processing alltogether when encountering some of them. these characters may affect text display in subtle unnoticable ways or in drastic global and irreversible ways depending on the hardware and software involved. the use of some of these characters may allow malicious users to manipulate the display of a legacy extended iri and its context. bidi formatting characters u+200e u+200f u+202a-202e these characters affect the display ordering of characters. displayed legacy extended iris containing these characters cannot be converted back to electronic form logical order unambiguously. these characters may allow malicious users to manipulate the display of a legacy extended iri and its context. specials u+fff0-fffd these code points provide functionality beyond that useful in a legacy extended iri for example byte order identification annotation and replacements for unknown characters and objects. their use and interpretation in a legacy extended iri serves no purpose and may lead to confusing display variations. private use code points u+e000-f8ff u+f0000-ffffd u+100000- 10fffd display and interpretation of these code points is by definition undefined without private agreement. therefore these code points are not suited for use on the internet. they are not interoperable and may have unpredictable effects. tags u+e0000-e0fff these characters provide a way to include language tags in unicode plain text. they are not appropriate for legacy extended iris because language information in identifiers cannot reliably be input transmitted for example on a visual medium such as paper or recognized. non-characters u+fdd0-fdef u+1fffe-1ffff u+2fffe-2ffff u+3fffe-3ffff u+4fffe-4ffff u+5fffe-5ffff u+6fffe-6ffff u+7fffe-7ffff u+8fffe-8ffff u+9fffe-9ffff u+afffe-affff u+bfffe-bffff u+cfffe-cffff u+dfffe-dffff u+efffe-effff u+ffffe-fffff u+10fffe-10ffff these code points are defined as non-characters. applications may use some of them internally but are not prepared to interchange them. for reference we here also list the code points and code units not even allowed in legacy extended iris surrogate code units u+d800-u+dfff these do not represent unicode codepoints. a references rfc2119 bradner s. key words for use in rfcs to indicate requirement levels bcp 14 rfc 2119 ietf march 1997. available online as http tools.ietf.org html bcp14 and http tools.ietf.org html rfc2119 rfc5234 crocker d. and p. overell eds augmented bnf for syntax specifications abnf rfc 5234 std 68 ietf january 2008. available online as http tools.ietf.org html rfc5234 rfc3629 yergeau f. utf-8 a transformation format of iso 10646 std 63 rfc 3629 ietf november 2003. available online as http tools.ietf.org html rfc3629. rfc3986 berners-lee t. r. fielding and l. masinter uniform resource identifier uri generic syntax std 66 rfc 3986 ietf january 2005. available online as http tools.ietf.org html rfc3986. rfc3987 internationalized resource identifiers iris rfc3987 d rst m. and m. suignard eds. ietf 2005. available online as http tools.ietf.org html rfc3987 iri-bis internationalized resource identifiers iris draft-duerst-iri-bis-04 d rst m. and m. suignard eds. ietf 2008. available online as http tools.ietf.org html draft-duerst-iri-bis-04. 